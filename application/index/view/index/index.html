{include file="public/header" /}
    <!--<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>-->
    <script src="/second-hand/public/static/js/jweixin-1.0.0.js"></script>
    <script src="/second-hand/public/static/js/jquery.form.js"></script>
    <script>

        wx.config({
            debug: '{$config.debug}',
            appId: '{$config.appId}',
            timestamp:'{$config.timestamp}',
            nonceStr: '{$config.nonceStr}',
            signature:'{$config.signature}',
            jsApiList:'{$jsApiList}'
        });

        wx.ready(function () {
            // 在这里调用 API
            //微信js初始化成功后再显示出“扫一扫”按钮
            $('p').show();

        });

        function getlocation() {

            wx.getLocation({
                type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                success: function (res) {
                    var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                    var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                    var speed = res.speed; // 速度，以米/每秒计
                    var accuracy = res.accuracy; // 位置精度

                    $.post(
                        "/second-hand/public/index/analysis/location",
                        {
                            latitude:latitude,
                            longitude:longitude,
                            speed:speed,
                            accuracy:accuracy
                        },
                        function(data,status){
                            //alert("数据: \n" + data + "\n状态: " + status);
                            scan();
                        });
                }
            });
        }

        function scan() {
            wx.scanQRCode({
                needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
                scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
                success: function (res) {
                    var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果

                    $.post(
                        "/second-hand/public/index/analysis/scan",
                        {
                            scan:result
                        },
                        function (data,status) {
                            //alert("数据: \n" + data + "\n状态: " + status);
                            var redirectUrl = "/second-hand/public/index/index/index";
                            window.location.assign(redirectUrl);
                        }
                    );

                }
            });
        }

    </script>
  <!--  <script>
        // wait for the DOM to be loaded
        $(document).ready(function() {
            var options = {
                target:        'jumbotron',   // target element(s) to be updated with server response
                beforeSubmit:  showRequest,  // pre-submit callback
                success:       showResponse,  // post-submit callback

                // other available options:
                //url:       url         // override for form's 'action' attribute
                type:      post,        // 'get' or 'post', override for form's 'method' attribute
                //dataType:  null        // 'xml', 'script', or 'json' (expected server response type)
                clearForm: false        // clear all form fields after successful submit
                //resetForm: true        // reset the form after successful submit

                // $.ajax options can be used here too, for example:
                //timeout:   3000
            };

            // bind to the form's submit event
            $('#saveUserBook').submit(function() {

                $(this).ajaxSubmit(options);

                return false;
            });
        });

        // pre-submit callback
        function showRequest(formData, jqForm, options) {
            // formData is an array; here we use $.param to convert it to a string to display it
            // but the form plugin does this for you automatically when it submits the data
            var queryString = $.param(formData);

            // jqForm is a jQuery object encapsulating the form element.  To access the
            // DOM element for the form do this:
            // var formElement = jqForm[0];

            alert('About to submit: \n\n' + queryString);

            // here we could return false to prevent the form from being submitted;
            // returning anything other than false will allow the form submit to continue
            return true;
        }

        // post-submit callback
        function showResponse(responseText, statusText, xhr, $form)  {

            alert('status: ' + statusText + '\n\nresponseText: \n' + responseText +
                '\n\nThe output div should have already been updated with the responseText.');
        }

    </script>-->
</head>
<body>
<div class="jumbotron">
    <h1>Hello, Let's HandJob!</h1>
    {eq name="location" value="0"}
    <p hidden><a class="btn btn-primary btn-lg" onclick="getlocation()">扫一扫</a></p>
    {else/}
    <p hidden><a class="btn btn-primary btn-lg" onclick="scan()">扫一扫</a></p>
    {/eq}

    <form id="saveUserBook" method="post" class="form-horizontal" action="{:url('Index/saveUserBook')}">
        <div>
            {volist name="bookInfo" id="vo" }
            <div class="media">
                <div class="media-left media-middle">
                    <a href="#">
                        <img class="media-objec" style="width: 100px" src="/second-hand/public/download/bookPic/{$vo['isbn']}.jpg" alt="">
                    </a>
                </div>
                <div class="media-body">
                    <h4 class="media-heading">{$vo['title']}</h4>
                    <input type="hidden" name="book_id[]" value="{$vo['id']}">
                    <div>作者：{$vo['author']}</div>
                    <div>出版社：{$vo['press']}</div>
                    <div>价格：{$vo['price']}</div>

                    <div class="checkbox">
                        <label>
                            <input type="checkbox"> Check me out
                        </label>
                    </div>
                </div>
            </div>
            {/volist}

        </div>
        {if condition="$bookInfo == null"}
        {else /}
        <button type="submit" id="submit" class="btn btn-default">Submit</button>
        {/if}

    </form>
</div>
</body>
<script>

</script>
</html>